---
title: "Assignment 4"
author: "Harikrishnan Shajil"
date: "10/19/2020"
output: html_document
---
## Library
```{r setup, include=FALSE}
library(dplyr)
library(tidyr)
library(magrittr)
library(ggplot2)
library(scales)
library(stringr)
library(gridExtra)
library(corrplot)
library(GGally)
```

## Question 1
## Import Data
## Patent by County from United States Patent And Trademark Office https://www.uspto.gov/web/offices/ac/ido/oeip/taf/countyall/usa_county_gd.htm
## Census by County from United Staes Census Bureau
https://www.census.gov/data/tables/time-series/demo/popest/2010s-counties-detail.html
```{r}
patents <- read.csv2(file = "c:/Computation and Vizualization/Assignment 4/Patents_By_County.csv", header = TRUE, sep = ",")
census <- read.csv2(file = "c:/Computation and Vizualization/Assignment 4/Census_Data.csv", header = TRUE, sep = ",")

```

## Filtering & Data Manipulation

```{r}
patents_2015 <- patents %>%
  select(State.or.Territory, Regional.Area.Component, X2015) %>%
  rename(State.x = State.or.Territory, County.x = Regional.Area.Component, PatentCount = X2015)
census_2015 <- census %>%
  select(STNAME, CTYNAME, POPESTIMATE2015) %>%
  rename(State.y = STNAME, County.y = CTYNAME, Population = POPESTIMATE2015)
census_2015$State.y <- toupper(census_2015$State.y)
```

## Inner Join

```{r}
df1 <- inner_join(patents_2015, census_2015, by = c("County.x" = "County.y", "State.x" = "State.y"))
df1 <- df1 %>% rename(County = County.x, State = State.x)
```

## Scatter Plot
## The relationship between patents generated by the county and their repective population is linear. We can see a positive trend, the number of patents increases as the population increases.
```{r}
df1 %>% ggplot(aes(x = Population, y = PatentCount)) +
  geom_point(color = "#FF4040") +
  scale_x_continuous(name = "Population", labels = comma, limits = c(0, 5000000)) +
  scale_y_continuous(name = "Number of Patents", labels = comma, limits = c(0, 5000)) +
  ggtitle("Plot of number of patents by population for the year 2015") +
  theme(plot.title = element_text(family = "Times New Roman", face = "bold.italic", color = "#000000", size = 12), axis.title.x = element_text(family = "Times New Roman", size = 12), axis.title.y = element_text(family = "Times New Roman", size = 12))

```

## Question 2
## 1 - Number of people living in urban and rural areas, World, 1960 to 2017
## Import Data
## Data from The World Bank https://datacatalog.worldbank.org/dataset/world-development-indicators

```{r}
wdi <- read.csv2(file = "c:/Computation and Vizualization/Assignment 4/WDIData.csv", header = TRUE, sep = ",")

```

## Filtering & Data Manipulation

```{r}
df2 <- wdi %>%
  filter(Indicator.Name == "Rural population" | Indicator.Name == "Urban population") %>%
  select(-c(1, 2, 4)) %>%
  pivot_longer(-c(Indicator.Name), names_to = "Year", values_to = "Population", values_drop_na = TRUE)
df2$Population <- as.numeric(df2$Population)
df2$Year <- as.numeric(str_replace(df2$Year, "[X]", ""))
df2 <- df2 %>%
  group_by(Indicator.Name, Year) %>%
  summarise(TotalPopulation = sum(Population, na.rm = TRUE))
df2 <- filter(df2, Year != 2018 & Year != 2019 & Year != 2020)
```

## Line Plot

```{r}
df2 %>% ggplot(aes(x = Year, y = TotalPopulation, group = Indicator.Name, color = Indicator.Name)) +
  geom_line() +
  geom_point() +
  scale_x_continuous(name = "Year", breaks = c(1960, 1970, 1980, 1990, 2000, 2010, 2017)) +
  scale_y_continuous(name = "Popuation", breaks = c(0.5 * 10^10, 1 * 10^10, 1.5 * 10^10, 2 * 10^10, 2.5 * 10^10, 3 * 10^10, 3.5 * 10^10, 4 * 10^10), labels = c("5 Million", "1 Billion", "1.5 Billion", "2 Billion", "2.5 Billion", "3 Billion", "3.5 Billion", "4 Billion")) +
  scale_color_manual(values = c("#576675", "#F7347A")) +
  ggtitle("Number of people living in urban and rural areas, World, 1960 to 2017") +
  theme(plot.title = element_text(family = "Times New Roman", size = 10, face = "bold.italic"), axis.title.x = element_text(family = "Times New Roman", size = 10), axis.title.y = element_text(family = "Times New Roman", size = 10)) +
  theme(legend.title = element_text(family = "Times New Roman", size = 10, face = "bold.italic")) +
  labs(color = "Indicator")
```

## 2 - Urban and rural population projected to 2050, World, 1500 to 2050
## Import data
## Data from United Nations World Urbanization Prospects 2018 https://population.un.org/wup/Download/
History Database of the Global Enviornment https://themasites.pbl.nl/tridion/en/themasites/hyde/basicdrivingfactors/population/index-2.html

```{r}
projected_2050 <- read.csv2(file = "c:/Computation and Vizualization/Assignment 4/Population_Projection_2050.csv", header = TRUE, sep = ",")

```

## Filtering & Data Manipulation

```{r}
df3 <- projected_2050 %>%
  rename(Indicator = 1) %>%
  pivot_longer(-c(Indicator), names_to = "Year", values_to = "Population")
df3$Year <- as.numeric(str_replace(df3$Year, "[X]", ""))
df3$Population <- as.numeric(df3$Population)
```

## Area Chart

```{r}
df3 %>% ggplot(aes(x = Year, y = Population, fill = Indicator)) +
  geom_area(color = "black", position = position_stack(reverse = TRUE)) +
  scale_x_continuous(name = "Year", breaks = c(1500, 1600, 1700, 1800, 1900, 2000, 2050)) +
  scale_y_continuous(name = "Population", limits = c(0, 10 * 10^9), breaks = c(2 * 10^9, 4 * 10^9, 6 * 10^9, 8 * 10^9, 10 * 10^9), labels = c("2 Billion", "4 Billion", "6 Billion", "8 Billion", "10 Billion")) +
  scale_fill_manual(values = c("#576675", "#F7347A")) +
  ggtitle("Urban and rural population projected to 2050, World, 1500 to 2050") +
  theme(plot.title = element_text(family = "Times New Roman", size = 10, face = "bold.italic"), axis.title.x = element_text(family = "Times New Roman", size = 10), axis.title.y = element_text(family = "Times New Roman", size = 10)) +
  theme(legend.title = element_text(family = "Times New Roman", size = 10, face = "bold.italic")) +
  labs(color = "Indicator")
```

## 3 - Urban Population vs GDP per capita for the year 2016
## Import Data
## Data from United Nations World Urbanization Prospects 2018 https://population.un.org/wup/Download/
University of Groningen - Maddison Project Database 2018
https://www.rug.nl/ggdc/historicaldevelopment/maddison/releases/maddison-project-database-2018

```{r}
urban_propotions <- read.csv2(file = "c:/Computation and Vizualization/Assignment 4/Proportion_Urban.csv", header = TRUE, sep = ",")
gdp <- read.csv2(file = "c:/Computation and Vizualization/Assignment 4/mpd2018.csv", header = TRUE, sep = ",")

```

## Filtering & Data Manipulation

```{r}
urban_propotions_df <- urban_propotions %>%
  select(Region..subregion..country.or.area, Continent, X2015) %>%
  rename(Country = 1, Pop_Proportion = 3)
gdp_df <- gdp %>%
  select(country, year, pop, rgdpnapc) %>%
  filter(year == 2016)
df5 <- inner_join(x = urban_propotions_df, y = gdp_df, by = c("Country" = "country"))
df5$Pop_Proportion <- as.numeric(df5$Pop_Proportion)
```

## Bubble Plot

```{r}
df5 %>% ggplot(aes(x = rgdpnapc, y = Pop_Proportion, color = Continent, size = pop)) +
  geom_point(alpha = .8) +
  scale_x_continuous(name = "GDP per capita ($)", breaks = c(10000, 50000, 100000, 150000), labels = c("$10000", "$50000", "$100000", "$150000")) +
  scale_y_continuous(name = "Share of population living in urban areas (%)", breaks = c(20, 40, 60, 80, 100), labels = c("20%", "40%", "60%", "80%", "100%")) +
  scale_size(range = c(.1, 20)) +
  geom_text(aes(label = Country), size = 1.5, color = "black") +
  scale_color_brewer(palette = "Set1") +
  ggtitle("Urban Population vs GDP per capita, 2016") +
  theme(plot.title = element_text(family = "Times New Roman", size = 10, face = "bold.italic"), axis.title.x = element_text(family = "Times New Roman", size = 10), axis.title.y = element_text(family = "Times New Roman", size = 10)) +
  theme(legend.title = element_text(family = "Times New Roman", size = 10, face = "bold.italic"))

```

## Question 3
## Import Data
## Data from Massachusetts Department of Elementary and Secondary Education
https://profiles.doe.mass.edu/statereport/sat.aspx


```{r}
SAT <- read.csv2(file = "c:/Computation and Vizualization/Assignment 4/sat_performance.csv", header = TRUE, sep = ",", na.strings = "")

```

## Filtering & Data Manipulation

```{r}
df6 <- SAT %>%
  select(1, 2, 3, 4, 6) %>%
  rename(DistrictName = 1, DistrictCode = 2, TestsTaken = 3, Reading.Writing = 4, Math = 5) %>%
  pivot_longer(-c(1, 2, 3), names_to = "Test", values_to = "AverageScore") %>%
  drop_na()
```

## Box Plot

```{r}
df6 %>% ggplot(aes(x = as.factor(Test), y = AverageScore, fill = as.factor(Test))) +
  geom_boxplot() +
  ggtitle("Average SAT scores for reading/writing and math") +
  scale_fill_manual(values = c("#007777", "#8b5a2b")) +
  xlab("Test") +
  ylab("Average Score") +
  theme(plot.title = element_text(family = "Times New Roman", size = 10, face = "bold.italic"), axis.title.x = element_text(family = "Times New Roman", size = 10), axis.title.y = element_text(family = "Times New Roman", size = 10)) +
  theme(legend.position = "none")
```

## Question 4
## Import Data
## Data from USA.com
http://www.usa.com/rank/massachusetts-state--median-household-income--school-district-rank.htm

```{r}
income <- read.csv2(file = "c:/Computation and Vizualization/Assignment 4/Median_Income.csv", header = TRUE, sep = ",")

```

## Filtering & Data Manipulation

```{r}
df7 <- income %>%
  select(2, 3) %>%
  rename(MedianIncome = 1, SchoolDistrict = 2) %>%
  separate(col = SchoolDistrict, into = c("District", NA), sep = " School District")
```

## Joining Income & SAT Scores

```{r}
df8 <- inner_join(x = df6, y = df7, by = c("DistrictName" = "District"))
df8$MedianIncome <- as.numeric(df8$MedianIncome)
```

## Scatter Plot

```{r}
df8 %>% ggplot(aes(x = MedianIncome, y = AverageScore, color = Test)) +
  geom_point() +
  scale_color_manual(values = c("#007777", "#8b5a2b")) +
  scale_y_continuous(name = "Average Score", limits = c(400, 700)) +
  scale_x_continuous(name = "Median Income", labels = c("$0", "$50,000", "$100,000", "$150,000", "$200,000")) +
  ggtitle("Average SAT scores vs. median income, Massachusetts school districts") +
  theme(plot.title = element_text(family = "Times New Roman", size = 10, face = "bold.italic"), axis.title.x = element_text(family = "Times New Roman", size = 10), axis.title.y = element_text(family = "Times New Roman", size = 10)) +
  theme(legend.title = element_text(family = "Times New Roman", size = 10, face = "bold.italic")) +
  labs(color = "Test")
```

## Filtering & Data Manipulation

```{r}
df9 <- df8 %>%
  select(-c(1, 2, 3)) %>%
  pivot_wider(names_from = Test, values_from = AverageScore)
```

## Correlation Plot
## There is positive correlation of 74% for both math and reading/writing scores with the median income. This is evident from the scatter plot above as well, SAT scores increase as median income levels increase.

```{r}
c <- cor(df9)
corrplot(c, method = "circle")
ggpairs(df9)
```

